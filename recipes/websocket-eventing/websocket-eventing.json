{
    "mashling_schema": "1.0",
    "gateway": {
        "name": "Gateway",
        "version": "1.0.0",
        "description": "This is a simple gateway opens a websocket connection to Mashery logs stream, parse each log message and creates an event in case of error/failure log.",
        "triggers": [
            {
                "name": "LogsListener",
                "description": "Listens to websocket endpoint",
                "type": "github.com/TIBCOSoftware/mashling/ext/flogo/trigger/wssub",
                "settings": {
                    "url": "<MASHERY_LOG_STREAM_URL>"
                },
                "handlers": [
                    {
                        "dispatch": "ProcessLog"
                    }
                ]
            }
        ],
        "dispatches": [
            {
                "name": "ProcessLog",
                "routes": [
                    {
                        "steps": [
                            {
                                "if": "payload.content.data[0].http_status_code == 404",
                                "service": "LogService",
                                "input": {
                                    "inputs.message": "DETECTED 404, NOTIFY ADMIN"
                                }
                            }
                        ],
                        "responses": []
                    }
                ]
            }
        ],
        "services": [
            {
                "name": "LogService",
                "description": "Log on error",
                "type": "flogoActivity",
                "settings": {
                    "ref": "github.com/TIBCOSoftware/flogo-contrib/activity/log"
                }
            }
        ]
    }
}